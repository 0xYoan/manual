# This htaccess file is used to do language redirects based on the first
# language in the Accept-Language HTTP header.
#
# Fallback order: lang-region -> lang -> en

RewriteEngine On

# Since the redirects in this file vary based on the Accept-Language header, we
# set the Vary header so that reverse proxy caches (e.g. Cloudflare) know how to
# key the cache.
<IfModule mod_headers.c>
  Header set Vary "Accept-Language"
</IfModule>

# Use english as default language
SetEnv MANUAL_LANGUAGE en
# If the first language in the HTTP Accept-Language is in the list of supported languages, use it
SetEnvIf Accept-Language "^(ca|cs|de|de-DE|en-GB|es|es-ES|es-MX|fi|fr|gl|id|it|ja-JP|kn|nl|pl|pt|pt-BR|ro|ru|ru-RU|sl|sq|sr|tr|zh-CN|zh-TW).*" MANUAL_LANGUAGE=$1
# If the language was specified explicitly on in the request URI, use it
RewriteRule "^/(.+)/(ca|cs|de|de-DE|en|en-GB|es|es-ES|es-MX|fi|fr|gl|id|it|ja-JP|kn|nl|pl|pt|pt-BR|ro|ru|ru-RU|sl|sq|sr|tr|zh-CN|zh-TW)/.* "-" [E=MANUAL_LANGUAGE:2]

# Redirect to requested page in the language determined above
RewriteRule ^/([^/]+)/$ /$1/%{ENV:MANUAL_LANGUAGE}/
RewriteRule ^/([^/]+)/(chapters/.*)$ /$1/%{ENV:MANUAL_LANGUAGE}/$2
RewriteRule ^/([^/]+)/(Mixxx-Manual\.pdf)$ /$1/%{ENV:MANUAL_LANGUAGE}/$2
